---

# python project CI workflow
on:
    push:
        branches:
            - dev
            - master

    pull_request:
        branches:
            - dev
            - master
jobs:
    Unittests:
        name: Run unit tests & quality checks
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                os: [ubuntu-20.04]
                python-version: [3.9.6]

        steps:
            - uses: actions/checkout@v3
            - name: Set up Python
              uses: actions/setup-python@v3
              with:
                  python-version: ${{ matrix.python-version }}

            - name: install required packages
              run: sudo apt-get install -y libxml2-utils

            - name: Install python  dependencies
              run: pip install -r requirements.txt

            - name: Run tests
              run: |
                  git config --global url."https://".insteadOf git://
                  pre-commit run --all-files --hook-stage=push

    IntegrationTest:
        name: Run Conversion Tests
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                os: [ubuntu-20.04]
                python-version: [3.9.6]

        steps:
            - uses: actions/checkout@v3
            - name: Set up Python
              uses: actions/setup-python@v3
              with:
                  python-version: ${{ matrix.python-version }}

            - name: install required packages
              run: sudo apt-get install -y libxml2-utils

            - name: Install dependencies
              run: pip install -r requirements.txt

            - name: Run conversions
              run: |-
                  ./bin/o2a-run-all-conversions py
                  rm -rf output/*
                  ./bin/o2a-run-all-conversions dot
